---
description: 
globs: games/**/*.ts,games/**/*.tsx
alwaysApply: false
---
# 2ï¸âƒ£ PhaserGameTemplate ãƒ«ãƒ¼ãƒ«

## é©ç”¨ç¯„å›²
**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³**: `games/p??-*/**/*.{ts,tsx}`  
VetGameSprint ã®10ã‚²ãƒ¼ãƒ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã«è‡ªå‹•é©ç”¨ã€‚  
Phaser 3 + React ã‚³ãƒ³ãƒ†ãƒŠã®å…±é€šå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¼·åˆ¶ã—ã€1é€±é–“10ã‚²ãƒ¼ãƒ å®Œæˆã‚’æ”¯æ´ã€‚

## ğŸ¯ è¨­è¨ˆåˆ¶ç´„ï¼ˆKPIé€£å‹•ï¼‰
- **ãƒ—ãƒ¬ã‚¤æ™‚é–“**: 90ç§’ä»¥å†…ã§å®Œäº†ã™ã‚‹è¨­è¨ˆ
- **ãƒªãƒˆãƒ©ã‚¤æ€§**: 60%ä»¥ä¸Šã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå†æŒ‘æˆ¦ã—ãŸããªã‚‹ä»•çµ„ã¿
- **LPé·ç§»**: 15%ä»¥ä¸Šã®è»¢è·ã‚µã‚¤ãƒˆé·ç§»ç‡ã‚’ç‹™ã†å ±é…¬è¨­è¨ˆ

## ğŸ› ï¸ æŠ€è¡“æ§‹æˆ

### Phaser 3 + Reactçµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// games/p01-puppy-click/index.tsx
import React, { useEffect, useRef } from 'react';
import Phaser from 'phaser';
import { GameScene } from './GameScene';
import { useGameStore } from '@/packages/game-core';

export const PuppyClickGame: React.FC = () => {
  const gameRef = useRef<Phaser.Game | null>(null);
  const { initGame, updateScore } = useGameStore();

  useEffect(() => {
    // Phaserè¨­å®š
    const config: Phaser.Types.Core.GameConfig = {
      type: Phaser.AUTO,
      width: 800,
      height: 600,
      parent: 'phaser-game',
      scene: GameScene,
    };
    
    gameRef.current = new Phaser.Game(config);
    initGame('p01-puppy-click');
    
    return () => gameRef.current?.destroy(true);
  }, []);

  return <div id="phaser-game" className="mx-auto" />;
};
```

### ã‚²ãƒ¼ãƒ ã‚·ãƒ¼ãƒ³æ¨™æº–æ§‹æˆ
```typescript
// games/p01-puppy-click/GameScene.ts
import Phaser from 'phaser';
import { analytics } from '@/packages/utils';

export class GameScene extends Phaser.Scene {
  private startTime!: number;
  private retryCount: number = 0;

  constructor() {
    super({ key: 'GameScene' });
  }

  // 1. åˆæœŸåŒ–
  init() {
    this.startTime = Date.now();
    
    // Plausible Analytics
    analytics.track('play', {
      gameId: 'p01-puppy-click',
      timestamp: this.startTime,
      userAgent: navigator.userAgent
    });
  }

  // 2. ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿
  preload() {
    this.load.image('puppy', '/assets/games/p01/puppy.png');
    this.load.audio('click', '/assets/games/p01/click.wav');
  }

  // 3. ã‚²ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ  
  create() {
    // 90ç§’åˆ¶é™ã‚¿ã‚¤ãƒãƒ¼
    this.time.addEvent({
      delay: 90000, // 90ç§’
      callback: this.endGame,
      callbackScope: this
    });

    // ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
    this.setupGameplay();
  }

  // 4. ãƒ•ãƒ¬ãƒ¼ãƒ æ›´æ–°
  update() {
    // å¿…è¦ã«å¿œã˜ã¦ã‚²ãƒ¼ãƒ çŠ¶æ…‹æ›´æ–°
  }

  private setupGameplay() {
    // ã‚²ãƒ¼ãƒ å›ºæœ‰ã®ãƒ­ã‚¸ãƒƒã‚¯
  }

  private endGame() {
    const playTime = Date.now() - this.startTime;
    
    // KPIè¿½è·¡
    analytics.track('game_end', {
      gameId: 'p01-puppy-click',
      playTime: playTime,
      retryCount: this.retryCount
    });

    // 90ç§’ä»¥å†…å®Œäº†ã§ãƒœãƒ¼ãƒŠã‚¹
    if (playTime <= 90000) {
      this.showSuccessModal();
    } else {
      this.showRetryModal();
    }
  }

  private showRetryModal() {
    // React UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµŒç”±ã§è¡¨ç¤º
    window.dispatchEvent(new CustomEvent('showRetryModal', {
      detail: { gameId: 'p01-puppy-click' }
    }));
  }
}
```

## ğŸ“¦ å…±é€šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ´»ç”¨

### 1. /packages/game-core å¿…é ˆåˆ©ç”¨
```typescript
import { 
  useGameStore,     // ZustandçŠ¶æ…‹ç®¡ç†
  GameConfig,       // å…±é€šè¨­å®šå‹
  createGameScene   // ãƒ™ãƒ¼ã‚¹ã‚·ãƒ¼ãƒ³ã‚¯ãƒ©ã‚¹
} from '@/packages/game-core';
```

### 2. /packages/ui çµ±ä¸€UI
```typescript
import {
  GameOverOverlay,  // ã‚²ãƒ¼ãƒ çµ‚äº†ãƒ¢ãƒ¼ãƒ€ãƒ«
  RetryButton,      // ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³
  LPTransitionButton, // è»¢è·ã‚µã‚¤ãƒˆé·ç§»ãƒœã‚¿ãƒ³
  ScoreDisplay,     // ã‚¹ã‚³ã‚¢è¡¨ç¤º
  TimerWidget       // 90ç§’ã‚¿ã‚¤ãƒãƒ¼
} from '@/packages/ui';
```

### 3. /packages/utils ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹
```typescript
import { analytics } from '@/packages/utils';

// å¿…é ˆã‚¤ãƒ™ãƒ³ãƒˆè¿½è·¡
analytics.track('play', { gameId, timestamp });     // ã‚²ãƒ¼ãƒ é–‹å§‹
analytics.track('retry', { gameId, retryCount });   // ãƒªãƒˆãƒ©ã‚¤
analytics.track('click_lp', { gameId, source });    // LPé·ç§»
```

## ğŸ¯ ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°çµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³

### LPé·ç§»ãƒœã‚¿ãƒ³è¨­ç½®
```typescript
// å„ã‚²ãƒ¼ãƒ çµ‚äº†æ™‚ã«è¡¨ç¤º
<LPTransitionButton 
  text="è»¢è·ã‚µã‚¤ãƒˆã§ã‚­ãƒ£ãƒªã‚¢ã‚’è¨ºæ–­ â–¶"
  utm={{
    source: 'game',
    medium: 'web', 
    campaign: 'vetgame',
    content: gameId
  }}
  onClickTracking={() => 
    analytics.track('click_lp', { gameId, score })
  }
/>
```

### å ±é…¬ãƒ«ãƒ¼ãƒ—å®Ÿè£…
```typescript
// 3å›ãƒªãƒˆãƒ©ã‚¤å¾Œã®ç‰¹åˆ¥ã‚ªãƒ•ã‚¡ãƒ¼
if (retryCount >= 3) {
  showRewardModal({
    title: "ç£åŒ»å¸«ã®ã‚­ãƒ£ãƒªã‚¢è¨ºæ–­PDFè´ˆå‘ˆï¼",
    ctaText: "ç„¡æ–™ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ â–¶",
    onClaim: () => analytics.track('reward_claim', { gameId })
  });
}
```

## ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ

### Tailwind + Framer Motionçµ±ä¸€
```typescript
// React UIéƒ¨åˆ†
<motion.div 
  className="w-full max-w-2xl mx-auto
             p-4 sm:p-6 md:p-8
             bg-white rounded-lg shadow-lg"
  initial={{ opacity: 0, scale: 0.9 }}
  animate={{ opacity: 1, scale: 1 }}
  transition={{ duration: 0.3 }}
>
  {/* ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ */}
</motion.div>
```

## ğŸš€ é«˜é€Ÿé–‹ç™ºãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```
games/p{XX}-{game-name}/
â”œâ”€â”€ index.tsx           # React ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ GameScene.ts        # ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚·ãƒ¼ãƒ³
â”œâ”€â”€ types.ts           # ã‚²ãƒ¼ãƒ å›ºæœ‰å‹å®šç¾©
â”œâ”€â”€ components/        # ã‚²ãƒ¼ãƒ å°‚ç”¨UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ assets/           # ã‚²ãƒ¼ãƒ ç”¨ã‚¢ã‚»ãƒƒãƒˆ
â””â”€â”€ README.md         # ã‚²ãƒ¼ãƒ ä»•æ§˜æ›¸
```

### æœ€å°å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] 90ç§’ä»¥å†…ã§ãƒ—ãƒ¬ã‚¤å¯èƒ½
- [ ] ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³å®Ÿè£…
- [ ] LPé·ç§»ãƒœã‚¿ãƒ³è¨­ç½®
- [ ] Plausible AnalyticsåŸ‹ã‚è¾¼ã¿
- [ ] /packages/game-coreåˆ©ç”¨
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼ˆTailwindï¼‰

---

**é–‹ç™ºå„ªå…ˆé †ä½**: æœ€å°ã‚³ã‚¢ãƒ¡ã‚«ãƒ‹ã‚¯ã‚¹å®Ÿè£… â†’ LPé·ç§»è¨­ç½® â†’ UI/UXæ”¹å–„ â†’ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 

